@model Travel_Agency___Data.ViewModels.PurchasedProductsSummaryViewModel

<div class="container purchased-products-container mt-5 pt-5">
    <h2 class="text-primary text-center mb-4">Purchased Products</h2>

    <!-- Search Bar -->
    <div class="search-bar-container mb-4 d-flex justify-content-center">
        <input type="text"
               id="search-bar"
               placeholder="Search by product name..."
               class="form-control w-50 shadow-sm" />
    </div>

    <!-- Table of Purchased Products -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="bg-primary text-white">
                <tr>
                    <th>Product Name</th>
                    <th>Base Price</th>
                    <th>Tax</th>
                    <th>Total Price</th>
                    <th>Purchase Date</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var product in Model.Products)
                {
                    <tr>
                        <td>@product.ProductName</td>
                        <td>@product.BasePrice.ToString("C")</td>
                        <td>@product.Tax.ToString("C")</td>
                        <td>@product.TotalPrice.ToString("C")</td>
                        <td>@product.PurchaseDate.ToString("yyyy-MM-dd")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- No Products Found Message -->
    <div id="no-results" class="alert alert-danger text-center mt-3" style="display: none;">
        <strong>No products found.</strong>
    </div>

    <!-- Summary Section -->
    <div class="summary-section mt-4 p-4 border rounded shadow-sm bg-light">
        <h4>Total Paid: <span class="text-success">@Model.TotalPaid.ToString("C")</span></h4>
        <h4>Outstanding Balance: <span class="text-danger">@Model.OutstandingBalance.ToString("C")</span></h4>
    </div>
</div>

<!-- JavaScript for Dynamic Search -->
<script>
    document.getElementById("search-bar").addEventListener("input", function (event) {
        const query = event.target.value.toLowerCase(); // Convert input to lowercase for case-insensitive matching
        const rows = document.querySelectorAll("table tbody tr"); // Select all rows in the table

        let hasResults = false;

        rows.forEach((row) => {
            const productName = row.querySelector("td:first-child").textContent.toLowerCase(); // First cell contains the product name
            if (productName.includes(query)) {
                row.style.display = ""; // Show the row if it matches
                hasResults = true;
            } else {
                row.style.display = "none"; // Hide the row if it doesn't match
            }
        });

        // Handle "No products found" message
        const noResultsMessage = document.getElementById("no-results");
        if (!hasResults) {
            noResultsMessage.style.display = "block"; // Show the message
        } else {
            noResultsMessage.style.display = "none"; // Hide the message
        }
    });
</script>
